{% extends "base.html" %}
{% block title %}–ü—Ä–æ—Ñ–∏–ª—å{% endblock %}

{% block content %}
<div class="profile-container">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–æ—Ñ–∏–ª—è -->
    <div class="profile-header">
        <div class="profile-avatar">
            <i class="fas fa-user-circle"></i>
        </div>
        <div class="profile-info">
            <h1>{{ user.username }}</h1>
            <div class="profile-meta">
                <span class="user-id">ID: {{ user.id }}</span>
                <span class="member-since">
                    <i class="far fa-calendar"></i>
                    {% if user.created_at %}
                        {{ user.created_at.strftime('%d.%m.%Y') }}
                    {% else %}
                        –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
                    {% endif %}
                </span>
            </div>
        </div>
        <div class="profile-badge">
            {% if user.achievement_unlocked %}
            <div class="achievement-badge">
                <i class="fas fa-trophy"></i>
                <span>–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ</span>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="stats-section">
        <h2 class="section-title"><i class="fas fa-chart-bar"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä—ã</h2>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-wallet"></i>
                </div>
                <div class="stat-content">
                    <h3>–ë–∞–ª–∞–Ω—Å</h3>
                    <p class="stat-value">{{ user.balance or 0 }} üíµ</p>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-dice"></i>
                </div>
                <div class="stat-content">
                    <h3>–í—Å–µ–≥–æ —Å—Ç–∞–≤–æ–∫</h3>
                    <p class="stat-value">{{ stats.total_bets }}</p>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-trophy"></i>
                </div>
                <div class="stat-content">
                    <h3>–í—ã–∏–≥—Ä–∞–Ω–Ω—ã—Ö —Å—Ç–∞–≤–æ–∫</h3>
                    <p class="stat-value">{{ stats.total_wins }}</p>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="stat-content">
                    <h3>–ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ–±–µ–¥</h3>
                    <p class="stat-value">{{ stats.win_rate }}%</p>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-coins"></i>
                </div>
                <div class="stat-content">
                    <h3>–û–±—â–∏–π –≤—ã–∏–≥—Ä—ã—à</h3>
                    <p class="stat-value">{{ stats.total_win_amount }} üíµ</p>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-crown"></i>
                </div>
                <div class="stat-content">
                    <h3>–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h3>
                    <p class="stat-value">
                        {% if user.achievement_unlocked %}
                            1 —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ
                        {% else %}
                            0
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è -->
    {% if user.achievement_unlocked %}
    <div class="achievements-section">
        <h2 class="section-title"><i class="fas fa-award"></i> –í–∞—à–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h2>

        <div class="achievements-grid">
            <div class="achievement-card unlocked">
                <div class="achievement-icon">
                    <i class="fas fa-camera"></i>
                </div>
                <div class="achievement-info">
                    <h3>–§–æ—Ç–æ —Å Icegergert</h3>
                    <p>–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ –ø—Ä–∏ –±–∞–ª–∞–Ω—Å–µ 3000+ üíµ</p>
                    <span class="achievement-date">–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ</span>
                </div>
            </div>

            <!-- –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π -->
            <div class="achievement-card locked">
                <div class="achievement-icon">
                    <i class="fas fa-gem"></i>
                </div>
                <div class="achievement-info">
                    <h3>–í–µ—Ç–µ—Ä–∞–Ω –∫–∞–∑–∏–Ω–æ</h3>
                    <p>–°–¥–µ–ª–∞–π—Ç–µ 100 —Å—Ç–∞–≤–æ–∫</p>
                    <span class="achievement-date">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ</span>
                </div>
            </div>

            <div class="achievement-card locked">
                <div class="achievement-icon">
                    <i class="fas fa-rocket"></i>
                </div>
                <div class="achievement-info">
                    <h3>–ë–æ–ª—å—à–æ–π –∫—É—à</h3>
                    <p>–í—ã–∏–≥—Ä–∞–π—Ç–µ 5000+ üíµ –∑–∞ –æ–¥–Ω—É —Å—Ç–∞–≤–∫—É</p>
                    <span class="achievement-date">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ</span>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- –ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞–≤–æ–∫ -->
    <div class="history-section">
        <div class="section-header">
            <h2 class="section-title"><i class="fas fa-history"></i> –ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞–≤–æ–∫</h2>
            <button class="btn btn-secondary" onclick="loadBetHistory()">
                <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å
            </button>
        </div>

        <div class="history-container">
            <div id="betHistory" class="bet-history">
                <!-- –ò—Å—Ç–æ—Ä–∏—è –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —á–µ—Ä–µ–∑ JavaScript -->
                <div class="loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ —Å—Ç–∞–≤–æ–∫...</p>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.profile-container {
    max-width: 1200px;
    margin: 0 auto;
}

/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–æ—Ñ–∏–ª—è */
.profile-header {
    display: flex;
    align-items: center;
    gap: 2rem;
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.05);
    border-radius: 16px;
    padding: 2rem;
    margin-bottom: 2rem;
    backdrop-filter: blur(10px);
}

.profile-avatar {
    width: 100px;
    height: 100px;
    background: linear-gradient(135deg, #3498db, #2ecc71);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 3rem;
    color: white;
    border: 3px solid rgba(255, 255, 255, 0.1);
}

.profile-info {
    flex: 1;
}

.profile-info h1 {
    font-size: 2.5rem;
    color: white;
    margin-bottom: 0.5rem;
}

.profile-meta {
    display: flex;
    gap: 1.5rem;
    color: #8a9ba8;
}

.user-id {
    background: rgba(52, 152, 219, 0.1);
    padding: 0.3rem 0.8rem;
    border-radius: 12px;
    font-size: 0.9rem;
}

.member-since {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.achievement-badge {
    background: linear-gradient(135deg, rgba(243, 156, 18, 0.2), rgba(231, 76, 60, 0.2));
    border: 1px solid rgba(243, 156, 18, 0.3);
    padding: 0.8rem 1.5rem;
    border-radius: 50px;
    display: flex;
    align-items: center;
    gap: 0.8rem;
    color: #f39c12;
    font-weight: 500;
}

.achievement-badge i {
    font-size: 1.2rem;
}

/* –°–µ–∫—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
.stats-section {
    margin-bottom: 3rem;
}

.section-title {
    font-size: 1.5rem;
    color: white;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.8rem;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
}

.stat-card {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    padding: 1.5rem;
    display: flex;
    align-items: center;
    gap: 1.5rem;
    transition: all 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-5px);
    border-color: rgba(255, 255, 255, 0.1);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
}

.stat-icon {
    width: 60px;
    height: 60px;
    background: rgba(52, 152, 219, 0.1);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.8rem;
    color: #3498db;
}

.stat-content h3 {
    color: #8a9ba8;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 0.5rem;
}

.stat-value {
    font-size: 1.8rem;
    font-weight: bold;
    color: white;
}

/* –°–µ–∫—Ü–∏—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π */
.achievements-section {
    margin-bottom: 3rem;
}

.achievements-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
}

.achievement-card {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    padding: 1.5rem;
    display: flex;
    align-items: center;
    gap: 1.5rem;
    transition: all 0.3s ease;
}

.achievement-card.unlocked {
    border-color: rgba(243, 156, 18, 0.3);
    background: rgba(243, 156, 18, 0.05);
}

.achievement-card.locked {
    opacity: 0.6;
    filter: grayscale(0.5);
}

.achievement-icon {
    width: 60px;
    height: 60px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.8rem;
    flex-shrink: 0;
}

.achievement-card.unlocked .achievement-icon {
    background: rgba(243, 156, 18, 0.2);
    color: #f39c12;
}

.achievement-card.locked .achievement-icon {
    background: rgba(255, 255, 255, 0.05);
    color: #8a9ba8;
}

.achievement-info {
    flex: 1;
}

.achievement-info h3 {
    color: white;
    margin-bottom: 0.5rem;
}

.achievement-info p {
    color: #8a9ba8;
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
}

.achievement-date {
    font-size: 0.85rem;
    padding: 0.2rem 0.6rem;
    border-radius: 12px;
    font-weight: 500;
}

.achievement-card.unlocked .achievement-date {
    background: rgba(46, 204, 113, 0.1);
    color: #2ecc71;
}

.achievement-card.locked .achievement-date {
    background: rgba(231, 76, 60, 0.1);
    color: #e74c3c;
}

/* –ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞–≤–æ–∫ */
.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
}

.history-container {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    padding: 1.5rem;
    min-height: 200px;
}

.bet-history {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: #8a9ba8;
    padding: 3rem;
    gap: 1rem;
}

.loading i {
    font-size: 2rem;
}

.bet-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem;
    background: rgba(255, 255, 255, 0.02);
    border-radius: 8px;
    border: 1px solid rgba(255, 255, 255, 0.03);
}

.bet-item.win {
    border-left: 4px solid #2ecc71;
}

.bet-item.lose {
    border-left: 4px solid #e74c3c;
}

.bet-info {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.bet-type {
    padding: 0.3rem 0.8rem;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 500;
}

.bet-type.red {
    background: rgba(231, 76, 60, 0.1);
    color: #e74c3c;
}

.bet-type.black {
    background: rgba(52, 152, 219, 0.1);
    color: #3498db;
}

.bet-type.number {
    background: rgba(155, 89, 182, 0.1);
    color: #9b59b6;
}

.bet-details {
    color: #8a9ba8;
    font-size: 0.9rem;
}

.bet-result {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.result-badge {
    padding: 0.3rem 0.8rem;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 500;
}

.result-badge.win {
    background: rgba(46, 204, 113, 0.1);
    color: #2ecc71;
}

.result-badge.lose {
    background: rgba(231, 76, 60, 0.1);
    color: #e74c3c;
}

.bet-amount {
    font-weight: bold;
    color: white;
}

.win-amount {
    color: #2ecc71;
    font-weight: bold;
}

.no-history {
    text-align: center;
    color: #8a9ba8;
    padding: 3rem;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
    .profile-header {
        flex-direction: column;
        text-align: center;
        gap: 1.5rem;
    }

    .profile-meta {
        flex-direction: column;
        gap: 0.5rem;
        align-items: center;
    }

    .stats-grid {
        grid-template-columns: 1fr;
    }

    .achievements-grid {
        grid-template-columns: 1fr;
    }

    .section-header {
        flex-direction: column;
        gap: 1rem;
        align-items: stretch;
    }

    .bet-item {
        flex-direction: column;
        gap: 1rem;
        align-items: stretch;
    }

    .bet-result {
        justify-content: space-between;
    }
}
</style>

<script>
// –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ —Å—Ç–∞–≤–æ–∫
async function loadBetHistory() {
    const historyContainer = document.getElementById('betHistory');
    historyContainer.innerHTML = `
        <div class="loading">
            <i class="fas fa-spinner fa-spin"></i>
            <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ —Å—Ç–∞–≤–æ–∫...</p>
        </div>
    `;

    try {
        const response = await fetch('/api/bets/history');
        const data = await response.json();

        if (data.bets && data.bets.length > 0) {
            let html = '';

            data.bets.forEach(bet => {
                const betClass = bet.result === 'win' ? 'win' : 'lose';
                const resultClass = bet.result === 'win' ? 'win' : 'lose';
                const resultText = bet.result === 'win' ? '–ü–æ–±–µ–¥–∞' : '–ü—Ä–æ–∏–≥—Ä—ã—à';

                let typeClass = '';
                let typeText = '';

                if (bet.type === 'red') {
                    typeClass = 'red';
                    typeText = '–ö—Ä–∞—Å–Ω–æ–µ';
                } else if (bet.type === 'black') {
                    typeClass = 'black';
                    typeText = '–ß–µ—Ä–Ω–æ–µ';
                } else {
                    typeClass = 'number';
                    typeText = `–ß–∏—Å–ª–æ ${bet.number}`;
                }

                html += `
                    <div class="bet-item ${betClass}">
                        <div class="bet-info">
                            <span class="bet-type ${typeClass}">${typeText}</span>
                            <div class="bet-details">
                                <span>${bet.created_at}</span>
                                <span> ‚Ä¢ </span>
                                <span class="bet-amount">${bet.amount} üíµ</span>
                            </div>
                        </div>
                        <div class="bet-result">
                            <span class="result-badge ${resultClass}">${resultText}</span>
                            ${bet.result === 'win' ?
                                `<span class="win-amount">+${bet.win_amount} üíµ</span>` :
                                ''
                            }
                        </div>
                    </div>
                `;
            });

            historyContainer.innerHTML = html;
        } else {
            historyContainer.innerHTML = `
                <div class="no-history">
                    <i class="fas fa-history fa-2x"></i>
                    <p>–ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞–≤–æ–∫ –ø—É—Å—Ç–∞</p>
                    <p>–°–¥–µ–ª–∞–π—Ç–µ —Å–≤–æ—é –ø–µ—Ä–≤—É—é —Å—Ç–∞–≤–∫—É!</p>
                </div>
            `;
        }
    } catch (error) {
        console.error('Error loading bet history:', error);
        historyContainer.innerHTML = `
            <div class="no-history">
                <i class="fas fa-exclamation-triangle fa-2x"></i>
                <p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏</p>
                <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ</p>
            </div>
        `;
    }
}

// –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', loadBetHistory);
</script>
{% endblock %}